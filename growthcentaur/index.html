<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thrivoy - Launch Your Business</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); margin:0; padding:0; color:#333; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    .hero { background: white; padding: 30px; border-radius: 10px; margin-top: 30px; }
    h1 { color: #764ba2; }
    label { display:block; margin-top:15px; font-weight:bold; }
    input, select, textarea { width:100%; padding:10px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
    button { margin-top:20px; background:#764ba2; color:white; padding:12px; border:none; border-radius:8px; cursor:pointer; width:100%; }
    .result { margin-top:20px; padding:15px; border-radius:8px; display:none; }
    .result.success { background:#d4edda; color:#155724; display:block; }
    .result.error { background:#f8d7da; color:#721c24; display:block; }
    .loading { text-align:center; margin:20px 0; display:none; }
    .tagline-box { background:#f1f1f1; padding:15px; border-radius:8px; margin-top:20px; }
    .iframe-container { display:none; }
  </style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <h1>üöÄ Thrivoy</h1>
      <p>AI-Powered Business Websites & Social Media</p>

      <form id="onboardForm">
        <!-- Core business info -->
        <label for="businessName">Business Name *</label>
        <input type="text" id="businessName" name="businessName" required>
        <label for="ownerName">Owner Name *</label>
        <input type="text" id="ownerName" name="ownerName" required>
        <label for="email">Email *</label>
        <input type="email" id="email" name="email" required>
        <label for="phone">Phone *</label>
        <input type="tel" id="phone" name="phone" required>
        <label for="category">Business Category *</label>
        <select id="category" name="category" required>
          <option value="">Choose...</option>
          <option value="healthcare">Healthcare</option>
          <option value="insurance">Insurance</option>
          <option value="technology">Technology</option>
          <option value="education">Education</option>
          <option value="consulting">Consulting</option>
          <option value="services">Services</option>
        </select>
        <label for="location">Location</label>
        <input type="text" id="location" name="location">
        <label for="description">Short Description</label>
        <textarea id="description" name="description"></textarea>

        <!-- Intelligence Questions -->
        <label for="painPoints">Customer Pain Points</label>
        <textarea id="painPoints" name="painPoints" placeholder="What problems does your business solve?"></textarea>
        <label for="goals">Business Goals</label>
        <textarea id="goals" name="goals" placeholder="What do you want to achieve with this website?"></textarea>
        <label for="audience">Target Audience</label>
        <textarea id="audience" name="audience" placeholder="Who is your ideal customer?"></textarea>
        <label for="tone">Preferred Tone/Style</label>
        <select id="tone" name="tone">
          <option value="">Choose...</option>
          <option value="professional">Professional</option>
          <option value="casual">Casual</option>
          <option value="friendly">Friendly</option>
          <option value="luxury">Luxury</option>
          <option value="innovative">Innovative</option>
        </select>

        <!-- AI Tagline Generator -->
        <div class="tagline-box">
          <h3>‚ú® AI Tagline Generator</h3>
          <button type="button" id="generateTaglineBtn">Generate Tagline</button>
          <div id="taglineSuggestions"></div>
        </div>

        <button type="submit">üéØ Create My Business Website</button>
      </form>

      <div class="loading" id="loading">‚è≥ Processing...</div>
      <div class="result success" id="resultSuccess"></div>
      <div class="result error" id="resultError"></div>
    </div>
  </div>

  <!-- hidden iframe for Apps Script post responses -->
  <div class="iframe-container"><iframe name="submissionIframe"></iframe></div>

  <script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyhVjQXzsl_pgYGBQkmp3GTIhEeEb25AAZfxj-0CwWnuDd_rRj7u2odPMuW7C4R6d3R/exec";

    // --- Helpers ---
    function postToAppsScriptViaIframe(data) {
      return new Promise((resolve, reject) => {
        const form = document.createElement("form");
        form.style.display = "none";
        form.method = "POST";
        form.action = APPS_SCRIPT_URL;
        form.target = "submissionIframe";
        for (let k in data) {
          const input = document.createElement("input");
          input.type = "hidden"; input.name = k; input.value = data[k];
          form.appendChild(input);
        }
        document.body.appendChild(form);

        const listener = (e) => {
          if (!String(e.origin).includes("script.google")) return;
          window.removeEventListener("message", listener);
          form.remove();
          resolve(e.data);
        };
        window.addEventListener("message", listener);
        form.submit();
      });
    }

    // --- AI Tagline Generator ---
    document.getElementById("generateTaglineBtn").addEventListener("click", async () => {
      const data = {
        action: "generateTagline",
        businessName: document.getElementById("businessName").value,
        category: document.getElementById("category").value,
        description: document.getElementById("description").value
      };
      document.getElementById("taglineSuggestions").innerText = "‚è≥ Generating...";
      try {
        const resp = await postToAppsScriptViaIframe(data);
        if (resp && resp.success && resp.taglines) {
          document.getElementById("taglineSuggestions").innerHTML =
            "<ul>" + resp.taglines.map(t => "<li>" + t + "</li>").join("") + "</ul>";
        } else {
          document.getElementById("taglineSuggestions").innerText = "‚ùå Failed to generate taglines.";
        }
      } catch (err) {
        document.getElementById("taglineSuggestions").innerText = "‚ùå Error: " + err.message;
      }
    });

    // --- Onboarding Form Submit ---
    document.getElementById("onboardForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      document.getElementById("loading").style.display = "block";
      document.getElementById("resultSuccess").style.display = "none";
      document.getElementById("resultError").style.display = "none";

      const data = {
        action: "onboard",
        businessName: document.getElementById("businessName").value,
        ownerName: document.getElementById("ownerName").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        category: document.getElementById("category").value,
        location: document.getElementById("location").value,
        description: document.getElementById("description").value,
        painPoints: document.getElementById("painPoints").value,
        goals: document.getElementById("goals").value,
        audience: document.getElementById("audience").value,
        tone: document.getElementById("tone").value
      };

      try {
        const resp = await postToAppsScriptViaIframe(data);
        document.getElementById("loading").style.display = "none";
        if (resp && resp.success) {
          document.getElementById("resultSuccess").innerText = "‚úÖ Success! Redirecting...";
          document.getElementById("resultSuccess").style.display = "block";
          const bizId = resp.businessId || (resp.business && resp.business.businessId);
          if (bizId) {
            setTimeout(() => {
              window.location.href =
                "https://thrivoydirect.github.io/site/thankyou.html?businessId=" + encodeURIComponent(bizId);
            }, 2000);
          }
        } else {
          document.getElementById("resultError").innerText =
            "‚ùå Submission failed: " + (resp.error || "Unknown error");
          document.getElementById("resultError").style.display = "block";
        }
      } catch (err) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("resultError").innerText = "‚ùå Error: " + err.message;
        document.getElementById("resultError").style.display = "block";
      }
    });
  </script>
</body>
</html>
