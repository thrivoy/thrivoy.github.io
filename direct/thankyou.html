<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Thank You - Thrivoy</title>
  <script src="config.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 40px; }
    .card { border: 2px solid #c3e6cb; padding: 20px; border-radius: 10px; background: #d4edda; display: inline-block; }
  </style>
</head>
<body>
  <h2>üéâ Thank You for Onboarding!</h2>
  <div class="card" id="thankYouCard">Loading details...</div>

  <script>
    function makeJSONPRequest(url, params, callback) {
      const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
      params.callback = callbackName;
      const queryString = Object.keys(params).map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params[k])).join('&');
      const script = document.createElement('script');
      script.src = url + '?' + queryString;
      window[callbackName] = function(data) {
        callback(data);
        document.head.removeChild(script);
        delete window[callbackName];
      };
      document.head.appendChild(script);
    }

    const urlParams = new URLSearchParams(window.location.search);
    const businessId = urlParams.get("businessId");

    if (businessId) {
      makeJSONPRequest(APPS_SCRIPT_URL, { action: "getThankYou", businessId }, function(response) {
        if (response.success) {
          document.getElementById('thankYouCard').innerHTML =
            `<h3>Welcome, ${response.ownerName}!</h3>
             <p>Your business <strong>${response.businessName}</strong> is onboarded.</p>
             <p><a href="dashboard.html?businessId=${businessId}">Go to Dashboard</a></p>`;

          // Log success
          makeJSONPRequest(APPS_SCRIPT_URL, {
            action: "log",
            event: "thankyou_view",
            businessId: businessId,
            formType: "thankyou"
          }, ()=>{});
        } else {
          document.getElementById('thankYouCard').innerHTML = "‚ùå Error: " + (response.error || "Unable to fetch details");
        }
      });
    } else {
      document.getElementById('thankYouCard').innerHTML = "‚ùå Missing businessId.";
    }
  </script>
</body>
</html>
