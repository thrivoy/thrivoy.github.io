<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thrivoy - AI-Powered Business Websites & Social Media</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            padding: 20px 0;
            text-align: center;
            color: white;
        }

        .hero {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 60px 40px;
            margin: 40px 0;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .hero h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #fff, #f1c40f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.3em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .cta-button {
            background: linear-gradient(45deg, #e74c3c, #f39c12);
            color: white;
            padding: 18px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .onboard-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .submit-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            display: block;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            display: block;
        }

        .website-link {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin-top: 10px;
        }

        .debug-log {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 200px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            overflow-y: auto;
            z-index: 1000;
        }

        .debug-controls {
            position: fixed;
            bottom: 230px;
            right: 20px;
            z-index: 1001;
        }

        .debug-btn {
            background: #333;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            margin: 2px;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5em;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .debug-log, .debug-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h2>üöÄ Thrivoy</h2>
            <p>AI-Powered Business Websites & Social Media Management</p>
        </header>

        <div class="hero">
            <h1>Launch Your Business Online in Minutes</h1>
            <p>Get a professional website + automated social media posts powered by AI</p>
            <button class="cta-button" onclick="showOnboardingForm()">
                üéØ Start Your Free Trial
            </button>
        </div>

        <form class="onboard-form" id="onboardForm">
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">
                üè¢ Tell Us About Your Business
            </h2>

            <div class="form-row">
                <div class="form-group">
                    <label for="businessName">Business Name *</label>
                    <input type="text" id="businessName" name="businessName" required>
                </div>
                <div class="form-group">
                    <label for="ownerName">Owner Name *</label>
                    <input type="text" id="ownerName" name="ownerName" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone *</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="category">Business Category *</label>
                    <select id="category" name="category" required>
                        <option value="">Choose category...</option>
                        <option value="Restaurant">Restaurant</option>
                        <option value="Retail">Retail Store</option>
                        <option value="Services">Professional Services</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Technology">Technology</option>
                        <option value="Education">Education</option>
                        <option value="Real Estate">Real Estate</option>
                        <option value="Fitness">Fitness & Wellness</option>
                        <option value="Beauty">Beauty & Personal Care</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="location">Location *</label>
                    <input type="text" id="location" name="location" placeholder="City, State" required>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Business Description *</label>
                <textarea id="description" name="description" placeholder="Briefly describe your business..." required></textarea>
            </div>

            <div class="form-group">
                <label for="tagline">Tagline</label>
                <input type="text" id="tagline" name="tagline" placeholder="Your business motto or catchphrase">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="brandPrimary">Primary Brand Color</label>
                    <input type="color" id="brandPrimary" name="brandPrimary" value="#1166EE">
                </div>
                <div class="form-group">
                    <label for="brandSecondary">Secondary Brand Color</label>
                    <input type="color" id="brandSecondary" name="brandSecondary" value="#FF8800">
                </div>
            </div>

            <div class="form-group">
                <label>Social Media Platforms</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="platform_linkedin" name="platforms" value="linkedin" checked>
                        <label for="platform_linkedin">LinkedIn</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="platform_facebook" name="platforms" value="facebook">
                        <label for="platform_facebook">Facebook</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="platform_instagram" name="platforms" value="instagram">
                        <label for="platform_instagram">Instagram</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="platform_whatsapp" name="platforms" value="whatsapp">
                        <label for="platform_whatsapp">WhatsApp</label>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="frequency">Posting Frequency</label>
                    <select id="frequency" name="frequency">
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tone">Content Tone</label>
                    <select id="tone" name="tone">
                        <option value="friendly" selected>Friendly</option>
                        <option value="professional">Professional</option>
                        <option value="casual">Casual</option>
                        <option value="authoritative">Authoritative</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="whatsappNumber">WhatsApp Business Number</label>
                <input type="tel" id="whatsappNumber" name="whatsappNumber" placeholder="Include country code (e.g., 917892159170)">
            </div>

            <div class="form-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="showWhatsApp" name="showWhatsApp" value="true" checked>
                    <label for="showWhatsApp">Show WhatsApp widget on website</label>
                </div>
            </div>

            <input type="hidden" name="action" value="onboard">
            <input type="hidden" name="plan" value="starter">
            <input type="hidden" name="price" value="499">

            <button type="submit" class="submit-btn" id="submitBtn">
                üöÄ Create My Business Website
            </button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Creating your website and setting up your business profile...</p>
            </div>

            <div class="result" id="result"></div>
        </form>
    </div>

    <!-- Debug Panel -->
    <div class="debug-controls">
        <button class="debug-btn" onclick="toggleDebug()">Toggle Debug</button>
        <button class="debug-btn" onclick="clearLog()">Clear Log</button>
    </div>
    <div class="debug-log" id="debugLog"></div>

    <script>
        // Configuration
        const CONFIG = {
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbwV8qUBA62C27x-xn4Z5Oij6ckMFgn3JIKCelof3HE9PbsDyT6LAhTqO4jPBFdlcl2aog/exec',
            TIMEOUT_MS: 30000
        };

        // Debug functionality
        let debugVisible = true;
        let debugLog = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            debugLog.push(logEntry);
            console.log('[Thrivoy Debug]', message);
            
            const debugEl = document.getElementById('debugLog');
            if (debugEl) {
                debugEl.innerHTML = debugLog.slice(-10).join('<br>');
                debugEl.scrollTop = debugEl.scrollHeight;
            }
        }

        function toggleDebug() {
            const debugEl = document.getElementById('debugLog');
            debugVisible = !debugVisible;
            debugEl.style.display = debugVisible ? 'block' : 'none';
        }

        function clearLog() {
            debugLog = [];
            document.getElementById('debugLog').innerHTML = '';
        }

        function showOnboardingForm() {
            document.querySelector('.hero').style.display = 'none';
            document.getElementById('onboardForm').style.display = 'block';
            log('Onboarding form displayed');
        }

        function showResult(message, isSuccess = false, data = null) {
            const resultEl = document.getElementById('result');
            const loadingEl = document.getElementById('loading');
            
            loadingEl.classList.remove('show');
            resultEl.className = `result ${isSuccess ? 'success' : 'error'}`;
            
            if (isSuccess && data && data.websiteUrl) {
                resultEl.innerHTML = `
                    <h3>üéâ Success! Your business is now online!</h3>
                    <p>${message}</p>
                    <p><strong>Business ID:</strong> ${data.businessId}</p>
                    <a href="${data.websiteUrl}" target="_blank" class="website-link">
                        üåê View Your Website
                    </a>
                    <p style="margin-top: 15px; font-size: 14px; color: #666;">
                        <strong>Next Steps:</strong><br>
                        ‚Ä¢ Your website will be live in 1-3 minutes<br>
                        ‚Ä¢ Check your email for login details<br>
                        ‚Ä¢ Start customizing your content and social media posts
                    </p>
                `;
            } else {
                resultEl.innerHTML = `<h3>${isSuccess ? '‚úÖ' : '‚ùå'} ${message}</h3>`;
            }
            
            resultEl.style.display = 'block';
        }

        // CORS-compatible form submission using iframe technique with enhanced response handling
        function submitViaIframe(formData) {
            return new Promise((resolve, reject) => {
                log('Creating submission iframe...');
                
                // Create iframe with better settings
                const iframe = document.createElement('iframe');
                iframe.style.cssText = 'display:none;width:0;height:0;border:none;';
                iframe.name = 'thrivoy-submit-frame-' + Date.now();
                iframe.sandbox = 'allow-scripts allow-same-origin allow-forms';
                document.body.appendChild(iframe);

                const form = document.createElement('form');
                form.method = 'POST';
                form.action = CONFIG.APPS_SCRIPT_URL;
                form.target = iframe.name;
                form.style.display = 'none';

                // Add form fields
                for (const [key, value] of formData.entries()) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                }

                document.body.appendChild(form);

                // Set up response handler
                let responseReceived = false;
                let timeoutId;
                let pollInterval;

                const cleanup = () => {
                    if (timeoutId) clearTimeout(timeoutId);
                    if (pollInterval) clearInterval(pollInterval);
                    window.removeEventListener('message', handlePostMessage);
                    try {
                        if (iframe.parentNode) document.body.removeChild(iframe);
                        if (form.parentNode) document.body.removeChild(form);
                    } catch (e) {
                        log('Cleanup error (non-critical): ' + e.message);
                    }
                };

                const handlePostMessage = (event) => {
                    if (responseReceived) return;
                    
                    // Filter out unrelated messages
                    if (!event.data || typeof event.data !== 'object') return;
                    if (!event.data.hasOwnProperty('success') && !event.data.hasOwnProperty('action')) return;
                    
                    try {
                        log('Received postMessage response');
                        responseReceived = true;
                        cleanup();
                        
                        const data = event.data;
                        log(`Response data: ${JSON.stringify(data)}`);
                        
                        if (data.success) {
                            resolve(data);
                        } else {
                            reject(new Error(data.error || 'Unknown error'));
                        }
                    } catch (error) {
                        log(`Response parsing error: ${error.message}`);
                        reject(error);
                    }
                };

                // Enhanced iframe content polling as backup
                const pollIframeContent = () => {
                    if (responseReceived) return;
                    
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
                        if (iframeDoc && iframeDoc.body) {
                            const bodyText = iframeDoc.body.textContent || '';
                            const bodyHtml = iframeDoc.body.innerHTML || '';
                            
                            // Look for success/error indicators in the content
                            if (bodyHtml.includes('"success":true') || bodyText.includes('Success')) {
                                log('Detected success from iframe content');
                                responseReceived = true;
                                cleanup();
                                
                                // Try to extract data from HTML
                                const match = bodyHtml.match(/"businessId":"([^"]+)"/);
                                const businessId = match ? match[1] : 'BIZ-' + Date.now();
                                
                                resolve({
                                    success: true,
                                    businessId: businessId,
                                    websiteUrl: `https://thrivoydirect.github.io/site/sites/${businessId}/`,
                                    message: 'Business onboarded successfully'
                                });
                            } else if (bodyHtml.includes('"success":false') || bodyText.includes('Error')) {
                                log('Detected error from iframe content');
                                responseReceived = true;
                                cleanup();
                                
                                const errorMatch = bodyHtml.match(/"error":"([^"]+)"/);
                                const error = errorMatch ? errorMatch[1] : 'Unknown error occurred';
                                reject(new Error(error));
                            }
                        }
                    } catch (e) {
                        // Cross-origin restrictions might prevent access - this is normal
                    }
                };

                // Set up timeout
                timeoutId = setTimeout(() => {
                    if (!responseReceived) {
                        responseReceived = true;
                        log('Request timeout - no response received');
                        cleanup();
                        reject(new Error('Request timeout. Your submission may have been processed - please check your email or try refreshing the page.'));
                    }
                }, CONFIG.TIMEOUT_MS);

                // Listen for postMessage
                window.addEventListener('message', handlePostMessage);
                
                // Start polling iframe content as backup
                pollInterval = setInterval(pollIframeContent, 2000);

                // Submit form
                log('Submitting form via iframe...');
                form.submit();
                
                // Initial content check after a short delay
                setTimeout(pollIframeContent, 3000);
            });
        }

        // Form submission handler
        document.getElementById('onboardForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            log('Form submission started');
            
            const submitBtn = document.getElementById('submitBtn');
            const loadingEl = document.getElementById('loading');
            const resultEl = document.getElementById('result');
            
            // Reset UI
            submitBtn.disabled = true;
            loadingEl.classList.add('show');
            resultEl.style.display = 'none';
            
            try {
                // Collect form data
                const formData = new FormData(this);
                
                // Handle checkboxes for platforms
                const platforms = Array.from(document.querySelectorAll('input[name="platforms"]:checked'))
                    .map(cb => cb.value);
                formData.set('platforms', platforms.join(','));
                
                // Log form data for debugging
                const debugData = {};
                for (const [key, value] of formData.entries()) {
                    debugData[key] = value;
                }
                log(`Form data: ${JSON.stringify(debugData)}`);
                
                // Submit via iframe
                const response = await submitViaIframe(formData);
                
                log('Submission successful');
                showResult('Your business website has been created!', true, response);
                
            } catch (error) {
                log(`Submission error: ${error.message}`);
                showResult(`Error: ${error.message}`, false);
            } finally {
                submitBtn.disabled = false;
                loadingEl.classList.remove('show');
            }
        });

        // Initialize
        log('Page loaded, ready for form submission...');
    </script>
</body>
</html>
